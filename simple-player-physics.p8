pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- simple player physics

player = {
	x = 8,
	y = -8,
	dx = 0, -- velocity
	dy = 0,
	w = 8,
	h = 8,
	state = "idle",
	jump_strength = -3.5,
	gravity = 0.2,
	max_fall_speed = 4,

 -- ---------------------------
	update = function(self)
		
		-- basic movement
		if btn(⬅️) then 
			self.dx=-2
		elseif btn(➡️) then
			self.dx=2
		else
			self.dx=0
		end

		-- state: idle
		if self.state=="idle" then
			if btn(🅾️) then
				if self:on_ground() then
					self.state="jumping"
					self.dy=self.jump_strength
					sfx(0)
				end
			end
		
		-- state: jump
		elseif self.state=="jumping" then
			if self:on_ground() and self.dy > 0 then
				self.state="idle"
				self.dy=0
				self.y=flr(self.y/8)*8
			end
		end
		
		-- apply gravity
		self.dy = min(
			self.dy+self.gravity,
			self.max_fall_speed)
			
		-- apply movement
		self.x += self.dx
		self.y += self.dy
		
		-- keep on screen
		self.x = mid(0,self.x,127-self.w)
		self.y = mid(0,self.y,127-self.h)		
	end,
	
 -- ---------------------------
	on_ground = function(self)
		-- bottom of player
		local below_y=self.y+self.h
		
		-- if bottom of screen
		if (below_y >= 127) return true
		
		-- check for solid tiles
		local left_tile = mget(
			flr(self.x/8),
			flr(below_y/8))
			
		local right_tile = mget(
			flr((self.x+self.w-1)/8),
			flr(below_y/8))
			
		return fget(left_tile,0) or fget(right_tile,0)
						
	end,
	
	-- ---------------------------
	draw = function(self)
		spr(1,self.x,self.y)
	end
}


function _init()
	-- set up map
	for i=0,15 do
		mset(i,15,2)
	end
	
	-- set flag 0 for solid tiles
	fset(1,0,true)	
end


function _update()
	player:update()
end


function _draw()
	cls(1)
	map(0,0,0,0,16,16)
	player:draw()
	
	
	--debug
	print("dx: "..player.dx,2,2,7)
	print("dy: "..player.dy)
end
__gfx__
00000000cc0000cc6666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c00c005555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000cccccc05555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000c7cc7c05555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000c00c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c0000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c0000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000d05013050180501e05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
